<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìƒí™œê³¼ ìœ¤ë¦¬</title>

<link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<style>
body{
  font-family: 'Pretendard', sans-serif;
  background: linear-gradient(135deg,#0f172a,#134e4a);
  color:white;
}
.card{
  background: rgba(255,255,255,0.07);
  backdrop-filter: blur(14px);
}
.correct{ background:#065f46 !important; }
.wrong{ background:#7f1d1d !important; }
</style>
</head>

<body class="flex justify-center items-start min-h-screen pt-10">

<!-- ìƒë‹¨ í™ˆ -->
<div class="fixed top-5 right-5 z-50">
<button onclick="goMainHome()" class="bg-slate-800 px-4 py-2 rounded-full shadow text-sm">
ğŸ  í™ˆ
</button>
</div>

<div class="w-full max-w-md p-4">

<!-- ë‹¨ì› ì„ íƒ -->
<div id="unitScreen" class="card p-6 rounded-2xl shadow-xl text-center">
<h1 class="text-xl font-bold mb-6">ìƒí™œê³¼ ìœ¤ë¦¬</h1>

<p id="loadingText" class="text-xs text-teal-200 mb-4">
ë¬¸ì œ ë¡œë”© ì¤‘...
</p>

<div class="grid gap-3 text-sm opacity-40 pointer-events-none" id="unitButtons">
<button onclick="startUnit('í˜„ëŒ€ì˜ ì‚¶ê³¼ ì‹¤ì²œìœ¤ë¦¬')" class="bg-emerald-600 p-3 rounded-xl">1. í˜„ëŒ€ì˜ ì‚¶ê³¼ ì‹¤ì²œìœ¤ë¦¬</button>
<button onclick="startUnit('ìƒëª…ê³¼ ìœ¤ë¦¬')" class="bg-teal-600 p-3 rounded-xl">2. ìƒëª…ê³¼ ìœ¤ë¦¬</button>
<button onclick="startUnit('ì‚¬íšŒì™€ ìœ¤ë¦¬')" class="bg-cyan-600 p-3 rounded-xl">3. ì‚¬íšŒì™€ ìœ¤ë¦¬</button>
<button onclick="startUnit('ê³¼í•™ê³¼ ìœ¤ë¦¬')" class="bg-sky-600 p-3 rounded-xl">4. ê³¼í•™ê³¼ ìœ¤ë¦¬</button>
<button onclick="startUnit('ë¬¸í™”ì™€ ìœ¤ë¦¬')" class="bg-blue-600 p-3 rounded-xl">5. ë¬¸í™”ì™€ ìœ¤ë¦¬</button>
<button onclick="startUnit('í‰í™”ì™€ ê³µì¡´ì˜ ìœ¤ë¦¬')" class="bg-indigo-600 p-3 rounded-xl">6. í‰í™”ì™€ ê³µì¡´ì˜ ìœ¤ë¦¬</button>
</div>

<button onclick="showWrongNotes()" class="mt-6 text-sm underline">
ì˜¤ë‹µë…¸íŠ¸ ë³´ê¸°
</button>
</div>

<!-- ë¬¸ì œ í™”ë©´ -->
<div id="quizScreen" class="hidden card p-6 rounded-2xl shadow-xl">
<div class="flex justify-between text-xs mb-3 opacity-70">
<span id="unitTitle"></span>
<span id="progress"></span>
</div>

<h2 id="question" class="mb-6 text-base font-semibold"></h2>

<div id="choices" class="space-y-3"></div>

<p id="feedback" class="mt-4 text-sm"></p>

<button id="nextBtn" onclick="nextQuestion()" class="hidden mt-4 w-full bg-emerald-600 p-2 rounded-xl">
ë‹¤ìŒ ë¬¸ì œ â†’
</button>
</div>

</div>

<script>

let allProblems = [];
let currentUnit = "";
let currentSet = [];
let currentIndex = 0;
let dataLoaded = false;

fetch("./problems.json")
.then(res => res.json())
.then(data => {
  allProblems = data;
  dataLoaded = true;
  document.getElementById("loadingText").innerText = "ë‹¨ì›ì„ ì„ íƒí•˜ì„¸ìš”";
  document.getElementById("unitButtons").classList.remove("opacity-40","pointer-events-none");
});

function startUnit(unit){
  if(!dataLoaded){
    alert("ì•„ì§ ë¬¸ì œ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤.");
    return;
  }

  currentUnit = unit;
  generateRandomSet();

  document.getElementById("unitScreen").classList.add("hidden");
  document.getElementById("quizScreen").classList.remove("hidden");

  showQuestion();
}

function generateRandomSet(){
  let filtered = allProblems.filter(p=>p.unit===currentUnit);
  let shuffled = [...filtered].sort(()=>0.5-Math.random());
  currentSet = shuffled.slice(0,5);
  currentIndex = 0;
}

function showQuestion(){
  let p = currentSet[currentIndex];

  document.getElementById("unitTitle").innerText = currentUnit;
  document.getElementById("progress").innerText = (currentIndex+1)+" / 5";
  document.getElementById("question").innerText = p.question;

  let choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML="";
  document.getElementById("feedback").innerText="";
  document.getElementById("nextBtn").classList.add("hidden");

  if(p.type==="OX"){
    ["O","X"].forEach(c=>{
      let btn=document.createElement("button");
      btn.innerText=c;
      btn.className="w-full bg-slate-700 p-2 rounded-xl";
      btn.onclick=()=>checkAnswer(c,btn);
      choicesDiv.appendChild(btn);
    });
  }

  else if(p.type==="MC"){
    p.choices.forEach((c,i)=>{
      let btn=document.createElement("button");
      btn.innerText=c;
      btn.className="w-full bg-slate-700 p-2 rounded-xl text-left";
      btn.onclick=()=>checkAnswer(i,btn);
      choicesDiv.appendChild(btn);
    });
  }

  else if(p.type==="FILL"){
    let input=document.createElement("input");
    input.className="w-full p-3 rounded text-black";
    input.placeholder="ì •ë‹µ ì…ë ¥";

    input.addEventListener("keypress",function(e){
      if(e.key==="Enter"){
        checkAnswer(input.value,null);
      }
    });

    let btn=document.createElement("button");
    btn.innerText="í™•ì¸";
    btn.className="w-full bg-emerald-600 p-2 rounded-xl mt-3";
    btn.onclick=()=>checkAnswer(input.value,null);

    choicesDiv.appendChild(input);
    choicesDiv.appendChild(btn);
  }
}

function checkAnswer(choice,btn){
  let p = currentSet[currentIndex];
  let isCorrect = choice.toString().trim()===p.answer.toString();

  if(btn){
    btn.classList.remove("bg-slate-700");
    btn.classList.add(isCorrect ? "correct" : "wrong");
  }

  if(isCorrect){
    document.getElementById("feedback").innerText="ì •ë‹µì…ë‹ˆë‹¤ ğŸ‘";
  }else{
    document.getElementById("feedback").innerText="í•´ì„¤: "+p.explanation;
  }

  document.getElementById("nextBtn").classList.remove("hidden");
}

function nextQuestion(){
  currentIndex++;
  if(currentIndex>=5){
    document.getElementById("question").innerText="5ë¬¸ì œë¥¼ ëª¨ë‘ í’€ì—ˆìŠµë‹ˆë‹¤ ğŸ‘";
    document.getElementById("choices").innerHTML="";
    document.getElementById("feedback").innerText="";
    document.getElementById("nextBtn").classList.add("hidden");
    return;
  }
  showQuestion();
}

function goMainHome(){
  window.location.href="index.html";
}

</script>

</body>
</html>
