<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>μƒν™κ³Ό μ¤λ¦¬</title>

<link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<style>
body{
  font-family: 'Pretendard', sans-serif;
  background: linear-gradient(135deg,#0f172a,#134e4a);
  color:white;
}
.card{
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(12px);
}
.correct{ background:#065f46 !important; }
.wrong{ background:#7f1d1d !important; }
.home-icon{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#0f172a;
  padding:14px;
  border-radius:50%;
  box-shadow:0 6px 20px rgba(0,0,0,0.4);
  cursor:pointer;
}
</style>
</head>

<body class="flex justify-center items-start min-h-screen pt-8">

<div class="w-full max-w-md p-4">

<!-- λ‹¨μ› μ„ νƒ -->
<div id="unitScreen" class="card p-6 rounded-2xl shadow-xl text-center">
<h1 class="text-xl font-bold mb-6">μƒν™κ³Ό μ¤λ¦¬</h1>

<div class="grid gap-3 text-sm">
<button onclick="startUnit('ν„λ€μ μ‚¶κ³Ό μ‹¤μ²μ¤λ¦¬')" class="bg-emerald-600 p-3 rounded-xl">1. ν„λ€μ μ‚¶κ³Ό μ‹¤μ²μ¤λ¦¬</button>
<button onclick="startUnit('μƒλ…κ³Ό μ¤λ¦¬')" class="bg-teal-600 p-3 rounded-xl">2. μƒλ…κ³Ό μ¤λ¦¬</button>
<button onclick="startUnit('μ‚¬νμ™€ μ¤λ¦¬')" class="bg-cyan-600 p-3 rounded-xl">3. μ‚¬νμ™€ μ¤λ¦¬</button>
<button onclick="startUnit('κ³Όν•™κ³Ό μ¤λ¦¬')" class="bg-sky-600 p-3 rounded-xl">4. κ³Όν•™κ³Ό μ¤λ¦¬</button>
<button onclick="startUnit('λ¬Έν™”μ™€ μ¤λ¦¬')" class="bg-blue-600 p-3 rounded-xl">5. λ¬Έν™”μ™€ μ¤λ¦¬</button>
<button onclick="startUnit('ν‰ν™”μ™€ κ³µμ΅΄μ μ¤λ¦¬')" class="bg-indigo-600 p-3 rounded-xl">6. ν‰ν™”μ™€ κ³µμ΅΄μ μ¤λ¦¬</button>
</div>

<button onclick="showWrongNotes()" class="mt-6 text-sm underline">
μ¤λ‹µλ…ΈνΈ λ³΄κΈ°
</button>

</div>

<!-- λ¬Έμ  ν™”λ©΄ -->
<div id="quizScreen" class="hidden card p-6 rounded-2xl shadow-xl">

<div class="flex justify-between text-xs mb-3 opacity-70">
<span id="unitTitle"></span>
<span id="progress"></span>
</div>

<h2 id="question" class="mb-6 text-base font-semibold"></h2>

<div id="choices" class="space-y-3"></div>

<p id="feedback" class="mt-4 text-sm"></p>

<button id="nextBtn" onclick="nextQuestion()" class="hidden mt-4 w-full bg-emerald-600 p-2 rounded-xl">
λ‹¤μ λ¬Έμ  β†’
</button>

</div>

<!-- μ¤λ‹µλ…ΈνΈ ν™”λ©΄ -->
<div id="wrongScreen" class="hidden card p-6 rounded-2xl shadow-xl overflow-y-auto max-h-[75vh]">
<h2 class="font-bold mb-4">π“ μ¤λ‹µλ…ΈνΈ</h2>
<div id="wrongList" class="space-y-6 text-sm"></div>
</div>

</div>

<!-- μ „μ²΄ ν™ μ•„μ΄μ½ -->
<div class="home-icon" onclick="goMainHome()">
π 
</div>

<script>

let allProblems = [];
let currentUnit = "";
let currentSet = [];
let currentIndex = 0;
let wrongNotes = JSON.parse(localStorage.getItem("et_wrong")) || {};

fetch("./problems.json")
.then(res=>res.json())
.then(data=>{
  allProblems = data;
});

function startUnit(unit){
  currentUnit = unit;
  generateRandomSet();
  document.getElementById("unitScreen").classList.add("hidden");
  document.getElementById("quizScreen").classList.remove("hidden");
  showQuestion();
}

function generateRandomSet(){
  let filtered = allProblems.filter(p=>p.unit===currentUnit);
  let shuffled = filtered.sort(()=>0.5-Math.random());
  currentSet = shuffled.slice(0,5);
  currentIndex = 0;
}

function showQuestion(){
  let p = currentSet[currentIndex];

  document.getElementById("unitTitle").innerText = currentUnit;
  document.getElementById("progress").innerText = (currentIndex+1)+" / 5";
  document.getElementById("question").innerText = p.question;

  let choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML="";
  document.getElementById("feedback").innerText="";
  document.getElementById("nextBtn").classList.add("hidden");

  if(p.type==="OX"){
    ["O","X"].forEach(c=>{
      let btn=document.createElement("button");
      btn.innerText=c;
      btn.className="w-full bg-slate-700 p-2 rounded-xl";
      btn.onclick=()=>checkAnswer(c,btn);
      choicesDiv.appendChild(btn);
    });
  }
  else if(p.type==="MC"){
    p.choices.forEach((c,i)=>{
      let btn=document.createElement("button");
      btn.innerText=c;
      btn.className="w-full bg-slate-700 p-2 rounded-xl text-left";
      btn.onclick=()=>checkAnswer(i,btn);
      choicesDiv.appendChild(btn);
    });
  }
}

function checkAnswer(choice,btn){
  let p = currentSet[currentIndex];
  let isCorrect = (choice.toString().trim()===p.answer.toString());

  if(isCorrect){
    btn.classList.add("correct");
    document.getElementById("feedback").innerText="μ •λ‹µμ…λ‹λ‹¤ π‘";
  }else{
    btn.classList.add("wrong");
    document.getElementById("feedback").innerText="ν•΄μ„¤: "+p.explanation;

    if(!wrongNotes[currentUnit]) wrongNotes[currentUnit]=[];
    if(!wrongNotes[currentUnit].includes(p.number)){
      wrongNotes[currentUnit].push(p.number);
      localStorage.setItem("et_wrong",JSON.stringify(wrongNotes));
    }
  }

  document.getElementById("nextBtn").classList.remove("hidden");
}

function nextQuestion(){
  currentIndex++;
  if(currentIndex>=5){
    showRoundEnd();
    return;
  }
  showQuestion();
}

function showRoundEnd(){
  document.getElementById("question").innerText="5λ¬Έμ λ¥Ό λ¨λ‘ ν’€μ—μµλ‹λ‹¤ π‘";
  document.getElementById("choices").innerHTML="";
  document.getElementById("feedback").innerHTML=`
  <div class="underline cursor-pointer" onclick="showWrongNotes()">
  μ¤λ‹µλ…ΈνΈμ—μ„ ν‹€λ¦° λ¬Έμ  λ³µμµν•κΈ°
  </div>
  `;
  document.getElementById("nextBtn").classList.add("hidden");
}

function showWrongNotes(){
  document.getElementById("quizScreen").classList.add("hidden");
  document.getElementById("unitScreen").classList.add("hidden");
  document.getElementById("wrongScreen").classList.remove("hidden");

  let div=document.getElementById("wrongList");
  div.innerHTML="";

  for(let unit in wrongNotes){
    wrongNotes[unit].forEach(num=>{
      let problem = allProblems.find(p=>p.number==num && p.unit==unit);
      if(problem){
        div.innerHTML+=`
        <div class="p-4 bg-slate-800 rounded-xl">
          <div class="text-xs text-teal-300 mb-1">${unit} ${problem.number}λ²</div>
          <div class="mb-2">${problem.question}</div>
          <div class="text-emerald-400">μ •λ‹µ: ${problem.answer}</div>
          <div class="text-gray-300 mt-1">${problem.explanation}</div>
        </div>
        `;
      }
    });
  }
}

function goMainHome(){
  window.location.href="index.html";
}

</script>

</body>
</html>
